---
title: TP2 - Syst√®me de fichiers et permissions
---

# TP2 - Syst√®me de fichiers et permissions

!!! objectifs "Objectifs p√©dagogiques"

    √Ä l‚Äôissue de ce TP, l‚Äô√©tudiant sera capable de :
    
    - Comprendre la structure du syst√®me de fichiers Linux (hi√©rarchie, r√©pertoires standards)
    - Identifier les utilisateurs, groupes et fichiers syst√®me (`/etc/passwd`, `id`)
    - Lire et interpr√©ter les permissions en notation symbolique et octale
    - Modifier les permissions avec `chmod`
    - Manipuler les fichiers et r√©pertoires en tenant compte des droits d'acc√®s
    - Comprendre la diff√©rence entre permissions sur    fichiers et sur r√©pertoires
    - Exp√©rimenter les effets du `PATH` sur la r√©solution des commandes
    - Identifier les permissions n√©cessaires √† l‚Äôex√©cution d‚Äôune commande
    - Comprendre et manipuler le m√©canisme de `umask`




!!! info "Instructions"
    - On rappelle que dans tous les exercices le `$` en d√©but de commande repr√©sente le prompt, il n'est pas √† saisir lorsque vous √©crivez une ligne de commande.
    - Pour chaque nouvelle commande, n'h√©sitez pas √† consulter sa page de manuel avec la commande `man`, ou √† utiliser l'option `--help` (si elle est disponible) pour savoir ce qu'elle fait.


!!! tip "Bar√®me d‚Äôinterpr√©tation des exercices"

    > üìö = Facile, üìöüìö = Moyenne, üìöüìöüìö = √âlev√©e  


## Syst√®me de fichiers

!!! tip "Le syst√®me de fichiers Linux"

    Le syst√®me de fichiers Linux est une *arborescence* ou une *hi√©rarchie* de fichiers et de r√©pertoires. Le r√©pertoire racine est `/` et tous les autres r√©pertoires sont des sous-r√©pertoires de celui-ci. Les r√©pertoires sont s√©par√©s par des `/` et les fichiers sont des noms de fichiers. 
    
    Quand vous lancez un shell (i.e. ouvrez un terminal), celui-ci se trouve *dans* un r√©pertoire. Ce r√©pertoire est appel√© votre *r√©pertoire courant* ou *r√©pertoire de travail*. 

    Un syst√®me Linux typique comporte des dixaines de milliers de r√©pertoires syst√®me et de fichiers. La plupart de ces r√©pertoires et fichiers sont cach√©s et ne sont pas visibles par d√©faut. Ces fichiers et r√©pertoires cach√©s sont utilis√©s par le syst√®me d'exploitation pour stocker des informations de configuration et d'autres informations syst√®me.

    Les sous-r√©pertoires de la racine sont g√©n√©ralement r√©serv√©s aux fichiers syst√®me. Les r√©pertoires `/home` et `/tmp` sont utilis√©s pour stocker des fichiers temporaires et des fichiers personnels.

    √Ä moins d'√™tre un administrateur syst√®me, vous n'avez pas besoin de vous soucier de la plupart des fichiers et r√©pertoires syst√®me. Toutefois il est important de comprendre comment les r√©pertoires et les fichiers sont organis√©s afin de pouvoir naviguer dans le syst√®me de fichiers et de pouvoir trouver les fichiers dont vous avez besoin.

    Le tableau suivant d√©crit le contenu des principaux r√©pertoires du syst√®me de fichiers Linux.

    | R√©pertoire | Description |
    ------------ | -------------
    | `/` | R√©pertoire racine. Tous les autres r√©pertoires sont des sous-r√©pertoires de celui-ci. |
    | `/bin` | Contient les programmes essentiels au fonctionnement du syst√®me. |
    | `/boot` | Contient les fichiers n√©cessaires au d√©marrage du syst√®me. |
    | `/dev` | Contient les fichiers repr√©sentant les p√©riph√©riques. |
    | `/etc` | Contient les fichiers de configuration du syst√®me. |
    | `/home` | Contient les r√©pertoires personnels des utilisateurs. |
    | `/lib` | Contient les biblioth√®ques partag√©es et les modules du noyau. |
    | `/media` | Contient les points de montage des p√©riph√©riques amovibles. |
    | `/mnt` | Contient les points de montage des syst√®mes de fichiers temporaires. |
    | `/opt` | Contient les logiciels additionnels. |
    | `/proc` | Contient les informations sur les processus et le syst√®me. |
    | `/root` | R√©pertoire personnel de l'administrateur. |
    | `/run` | Contient les fichiers d'ex√©cution des applications. |
    | `/sbin` | Contient les programmes essentiels au fonctionnement du syst√®me. |
    | `/srv` | Contient les donn√©es des services fournis par le syst√®me. |
    | `/sys` | Contient les informations sur les p√©riph√©riques. |
    | `/tmp` | Contient les fichiers temporaires. |
    | `/usr` | Contient les programmes, les biblioth√®ques et les fichiers de configuration. |
    | `/var` | Contient les fichiers variables comme les logs, les mails, les bases de donn√©es, etc. |
    | `/lost+found` | Contient les fichiers r√©cup√©r√©s lors d'un crash du syst√®me. |

---

### Exercice 1 : `id` et `/etc/passwd` üìö

1. Entrez les commandes suivantes dans un terminal et notez les r√©sultats :
   ```bash
   $ id
   ```
2. Ensuite tapez la m√™me commande, mais cette fois-ci avec l'argument `root`, notez les r√©sultats.
   ```bash
   $ id root
   ```
3. Affichez ensuite le contenu du fichier `/etc/passwd` avec la commande `cat`. 
4. Recherchez les lignes o√π appara√Æssent votre nom d'utilisateur et celui de l'utilisateur `root`. Quelles sont les diff√©rences ?
5. Pouvez-vous d√©duire √† quoi sert le fichier `/etc/passwd` ?

## Permissions associ√©es aux fichiers

!!! tip "Protection des fichiers"
    
    Un syst√®me Linux peut permettre √† de nombreux utilisateurs d'acc√©der aux fichiers et aux r√©pertoires. Pour prot√©ger les fichiers et les r√©pertoires, Linux utilise un syst√®me de permissions. Les permissions sont des droits d'acc√®s aux fichiers et aux r√©pertoires. Les permissions sont associ√©es √† des utilisateurs et √† des groupes. Les utilisateurs sont des personnes qui ont un compte sur le syst√®me.

    Pour les fichiers normaux, les permissions sont associ√©es √† trois cat√©gories d'utilisateurs : le propri√©taire du fichier (g√©n√©ralement celui qui a cr√©e le fichier), le groupe propri√©taire du fichier et les autres utilisateurs. 
    
    Les cat√©gories de permissions pour un fichier sont les suivantes :
      
      - **read** `r`: permet de lire le contenu du fichier.
      - **write** `w`: permet de modifier le contenu du fichier.
      - **execute** `x`: permet d'ex√©cuter le fichier (si c'est un programme ou un script).

    L'option `-l` de la commande `ls` affiche les m√©ta-donn√©es associ√©es √† un fichier, son nom, sa taille, son propri√©taire, son groupe, ... et en particuler ses permissions, par exemple :

    ```bash
    $ ls -l fichier
    -rw-r--r-- 1 user group 0 2019-09-09 10:00 fichier
    ```

    La cha√Æne `-rw-r--r--` repr√©sente les permissions associ√©es au fichier. Le premier caract√®re d√©signe le type du fichier, les trois suivants repr√©sentent les permissions du propri√©taire, les trois suivants celles du groupe propri√©taire et les trois derniers celles des autres utilisateurs. Les permissions sont repr√©sent√©es par les caract√®res `r`, `w` et `x` pour les permissions respectivement en lecture, √©criture et ex√©cution. Si la permission n'est pas accord√©e, le caract√®re `-` est utilis√© √† la place.

    Les permissions peuvent √™tre repr√©sent√©es par des **chiffres (repr√©sentation en octal)** ou des **lettres (repr√©sentation symbolique)**.

    Le tableau suivant donne la correspondance entre les deux repr√©sentations :

    | Chiffre | Lettre | Description |
    | ------- | ------ | ----------- |
    | 0 | `---` | Aucune permission |
    | 1 | `--x` | Ex√©cution |
    | 2 | `-w-` | √âcriture |
    | 3 | `-wx` | √âcriture et ex√©cution |
    | 4 | `r--` | Lecture |
    | 5 | `r-x` | Lecture et ex√©cution |
    | 6 | `rw-` | Lecture et √©criture |
    | 7 | `rwx` | Lecture, √©criture et ex√©cution |


    C'est-√†-dire que pour la cha√Æne `-rw-r--r--` les permissions sont les suivantes :

    | | Utilisateur | Groupe | Autres |
    |-|----------- | ------ | ------ |
    | symbolique | `rw-` | `r--` | `r--` |
    | binaire | 110 | 100 | 100 |
    | octale | 6 | 4 | 4 |
---

### Exercice 2 : Permissions associ√©es aux fichiers üìö

1. Cr√©ez un r√©pertoire vide et un fichier vide (ces deux derniers doivent √™tre au m√™me niveau). Utilisez la commande `ls` et les options `-l` et `-d` sur chacun de ces deux nouveaux fichiers pour d√©terminer les permissions que vous (respectivement votre groupe et les autres) avez sur ces fichiers. Comment reconnaissez-vous un r√©pertoire ?

2. Les lignes suivantes donnent la r√©ponse de la commande `ls -ld` sur un certain r√©pertoire (pour les besoins de l'exercice nous n'avons report√© que le premier et le dernier champ du r√©sultat de `ls -ld`).
    ```bash
    drwxr-xr-x a
    dr-xr--r-- b
    -rw-r--r-- c.txt
    --w--w-r-- d.c
    -rwxr-xr-x op
    ```
    Parmi ces fichiers, quels sont les r√©pertoires ?
3. Pour chacun des fichiers ci-dessus, donnez les permissions associ√©es √† chacun des utilisateurs (propri√©taire, groupe propri√©taire et autres utilisateurs) en utilisant la repr√©sentation symbolique et la repr√©sentation octale.
4. Donnez la repr√©sentation symbolique et la repr√©sentation octale des permissions associ√©es au fichier `/etc/passwd`, √† la commande `ls` et √† votre r√©pertoire personnel.

### Exercice 3 : Modification des permissions `chmod` üìöüìö

1. Testez les commandes suivantes dans un terminal et essayez de comprendre comment fonctionne la commande `chmod` (avec la repr√©sentation symbolique).
    ```bash
    $ touch f; ls -l f
    $ chmod a= f; ls -l f
    $ chmod o+rw f; ls -l f
    $ chmod u=o f; ls -l f
    $ chmod o-wx f; ls -l f
    $ chmod g+u f; ls -l f
    $ chmod a+x,g-w f; ls -l f
    ```
2. Testez la commande `chmod 644 f; ls -l f`. Que fait cette commande ?
3. Avec les deux modes d'utilisation de `chmod` (octale et symbolique), modifiez les permissions du fichier `f` de la mani√®re suivante :
    - ex√©cution pour tous, lecture et √©criture uniquement pour le propri√©taire.
    - lecture et ex√©cution pour tous, personne ne peut √©crire.
    - toutes les permissions pour tous, pas d'√©criture pour les autres.
    - lecture et √©criture pour le propri√©taire, ex√©cution pour le groupe et aucune pour les autres.

### Exercice 4 : Permissions associ√©es aux fichiers normaux üìöüìö

1. Dans un r√©pertoire de votre choix, cr√©er deux fichiers `f` et `g`. Puis entrer (par exemple avec un √©diteur de texte) du texte dans ces fichiers.
2. Pour vous (propri√©taire), retirer la permission de lire dans le fichier `f` et la permission d'√©crire dans le fichier `g`.
3. Testez ensuite les commandes suivantes, puis notez les r√©sultats :
    ```bash
    $ cat f
    $ cat g
    ```
4. Essayer de modifier `g` avec un √©diteur de texte. Que se passe-t-il ?
5. Tester les commandes:
    ```bash
    $ cp f h
    $ cp g h
    ```
    Puis observer le contenu du fichier `h` ainsi que les permissions associ√©es √† ce fichier.
6. La commande suivante permet d'√©crire la cha√Æne `toto` √† la fin du fichier `f` (nous la verrons plus en d√©tail dans un prochain TP) :
    ```bash
    $ echo "toto" >> f
    ```
    Tester cette commande, puis redonnez-vous les droits de lecture sur le fichier `f`. Enfin affichez le contenu du fichier `f` gr√¢ce √† la commande `cat`.
7. Tester la commande:
    ```bash
    $ rm g
    ```
    **Tapez `n` pour refuser**. Enfin tester la commande suivante:
    ```bash
    $ rm -f g
    ```
    A-t-elle r√©ussie ? Que pouvez vous en d√©duire ?

## Permissions associ√©es aux r√©pertoires

!!! tip "Qu'est-ce qu'un r√©pertoire ?"
    
    Un r√©pertoire est une table de noms de fichiers associ√©s √† un num√©ro d'index appel√© *num√©ro d'inode* qui permet de conna√Ætre les informations (contenues dans l'inode) concernant ce fichier (taille, permissions, horodatage, o√π trouver le contenu du fichier, ...).

    Dans un r√©pertoire, les permissions ne sont pas associ√©es aux fichiers mais au r√©pertoire lui-m√™me. Les permissions associ√©es √† un r√©pertoire sont :

      - **read** `r`: permet de lister le contenu du r√©pertoire.
      - **write** `w`: permet de modifier le contenu du r√©pertoire (cr√©er ou supprimer des fichiers).
      - **execute** `x`: permet d'ouvrir le r√©pertoire (avec la commande `cd` par exemple).
---

### Exercice 5 : Permissions associ√©es aux r√©pertoires üìöüìöüìö

1. Cr√©ez un r√©pertoire `rep` et deux fichiers normaux `a` et `b` √† l'int√©rieur de ce r√©pertoire.
2. Retirez toutes les permissions sur le r√©pertoire `rep` et essayez les commandes suivantes :
    ```bash
    $ cd rep
    $ ls rep
    $ cat rep/a
    $ touch rep/c
    $ rm rep/a
    ```
3. Redonnez la permission *read* uniquement sur le r√©pertoire `rep` et essayez les toutes les commandes de la question 2. Notez les diff√©rences.
4. M√™me question mais avec seulement la permission *write* sur `rep`. Notez les diff√©rences.
5. Cette fois-ci avec uniquement la permission *execute* sur `rep`. Testez les commandes suivantes :
    ```bash
    $ cd rep
    $ ls rep
    $ echo "toto" >> rep/a
    $ cat rep/c
    $ ls -l rep/a
    $ touch rep/c
    $ rm rep/a
    ```
6. Avec l'ensemble de permissions `-wx` sur `rep` pour tous les utilisateurs, essayez de:
      
      - cr√©er un fichier `d` dans `rep`
      - renommer le fichier `b`
      - retirer toutes les permissions associ√©es au fichier `d`
      - supprimer le fichier `d`


### Exercice 6 : Les r√©pertoires du `PATH` üìöüìöüìö

!!! warning "Attention"
    
    Cet exercice de type *exp√©rimentation* est d√©licat et important. Il faut le traiter avec un soin particulier et en prenant son temps.

1. Ouvrir un nouveau terminal et entrer la commande suivante :
    ```bash
    $ echo $PATH
    ```
    Observer le r√©sultat, √† votre avis √† quoi correspondent les √©l√©ments s√©par√©s par des `:` ?
2. Cr√©er un r√©pertoire `bin` dans votre r√©pertoire personnel et entrer les commandes suivantes:
    ```bash
    $ PATH=~/bin:$PATH
    $ echo $PATH
    ```
    Quelle est la diff√©rence avec d'affichage avec le r√©sultat de la question 1 ?
3. √Ä l‚Äôaide de la commande `type`, chercher les chemin absolus des programmes `cat` et `rm` et les noter.
4. Faire une copie de `cat` dans `~/bin` en le renommant `rm`.
5. Cr√©er un fichier `fic`, y mettre quelques caract√®res et cr√©er deux copies `fic2` et `fic3` de `fic`.
6. Essayer de d√©truire `fic` avec la commande `rm`. Que s‚Äôest-il pass√© ?
7. Entrer la commande `$ type rm`.
8. Lancer la commande
    ```bash
    $ <chemin vers rm> fic
    ```
    en rempla√ßant `<chemin vers rm>` par le chemin absolu vers la commande `rm` not√© √† la question 3. Que s‚Äôest-il pass√© ?
9. Enlever la permission `x` sur le fichier `~/bin/rm` et essayer de supprimer `fic2`.
10. Demander au shell d‚Äôoublier les emplacements enregistr√©s (¬´ hach√©s ¬ª) avec la commande `$ hash -r`, puis entrer les commandes
    ```bash
    $ type rm
    $ rm fic2
    ```
11. Remettre la permission `x` sur `~/bin/rm` puis entrer les commandes suivantes (o√π `<chemin vers rm>` d√©signe le chemin absolu not√© √† la question 3) :
    ```bash
    $ ~/bin/rm fic3
    $ cd ~/bin
    $ ./rm fic3
    $ <chemin vers rm> rm
    $ rm fic3
    ```
12. Faire le bilan de cet exercice en r√©pondant aux questions suivantes :
    - Qu'est-ce qui est contenu dans `PATH` ?
    - Dans quel cas est-ce qu‚Äôun nom de commande est cherch√© dans les r√©pertoires du `PATH` ?
    - S‚Äôil y a plusieurs programmes correspondants dans les r√©pertoires du `PATH`, lequel est choisi ?


## R√©capitulatif sur permissions et permissions par d√©faut

### Exercice 7: On lache le clavier üìöüìö

!!! info "Consigne"
    
    Cet exercice est √† faire √† l‚Äô√©crit, on l√¢che le clavier !

Pour chacune des commandes suivantes, dire quelles permissions sont n√©cessaires pour qu‚Äôelle r√©ussisse (on suppose que tous les r√©pertoires et fichiers existent, sauf ceux qu‚Äôon veut cr√©er).

```bash
$ cat /usr/include/stdio.h
$ cd /usr/include/
$ ls /usr/include/
$ echo '/* fin */' >> /usr/include/stdio.h
$ rm /usr/include/stdio.h
$ touch /usr/include/ma_bib.h
$ chmod u+w /usr/include/stdio.h
$ /usr/bin/uname
```

### Exercice 8 : Permissions par d√©faut et `umask` (optionnel) üìöüìöüìö

!!! tip 

    `umask` est une commande qui permet de d√©finir les permissions par d√©faut des fichiers et des r√©pertoires que vous cr√©ez. La valeur de l'umask est une valeur octale qui est *soustraite* des permissions par d√©faut. Par exemple, si l'umask vaut 022, les permissions par d√©faut sont 755 pour les r√©pertoires et 644 pour les fichiers.

1. Dans un terminal, tapez la commande `umask` et notez le r√©sultat.
2. Cr√©ez un r√©pertoire `rep` et un fichier `f` au m√™me niveau que `rep`. Affichez les permissions associ√©es √† `rep` et `f` avec la commande `ls -ld rep f`. Convertissez ces permissions en repr√©sentation octale et notez-les. Enfin, supprimez `rep` et `f`.
5. Changez la valeur du masque avec la commande
    ```bash
    $ umask 240
    ```
4. Changez la valeur du masque avec la commande
    ```bash
    $ umask 121
    ```
    puis refaites la question 2.
5. Changez la valeur du masque avec la commande
    ```bash
    $ umask 666
    ```
    puis refaites la question 2.
6. De toutes les questions pr√©c√©dentes, pouvez-vous d√©duire comment la valeur de l'umask agit sur les permissions associ√©es aux r√©pertoires et aux fichiers que vous cr√©ez ?
7. Donnez √† l'umask sa valeur initiale.